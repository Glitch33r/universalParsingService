{% extends 'base.html' %}

{% load static %}

{% block title %}Recovering password{% endblock %}

{% block custom-style %}
    <link href="{% static "main/css/demo1/pages/general/login/login-6.css" %}" rel="stylesheet" type="text/css"/>
{% endblock %}

{% block body-cls %}class="kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed
    kt-header-mobile--fixed kt-subheader--fixed kt-subheader--enabled kt-subheader--solid kt-aside--enabled
    kt-aside--fixed kt-page--loading"{% endblock %}

{% block body %}
    <div class="kt-grid kt-grid--ver kt-grid--root">
        <div class="kt-grid kt-grid--hor kt-grid--root  kt-login kt-login--v6 kt-login--signin" id="kt_login">
            <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--desktop kt-grid--ver-desktop kt-grid--hor-tablet-and-mobile">
                <div class="kt-grid__item  kt-grid__item--order-tablet-and-mobile-2  kt-grid kt-grid--hor kt-login__aside">
                    <div class="kt-login__wrapper">
                        <div class="kt-login__container">
                            <div class="kt-login__body">
                                <div class="kt-login__forgot__new">
                                    <div class="kt-login__head">
                                        <h3 class="kt-login__title">Forgotten Password ?</h3>
                                        <div class="kt-login__desc">Enter new password:</div>
                                    </div>
                                    <div class="kt-login__form">
                                        <form class="kt-form" action="">
                                            {% csrf_token %}

                                            <div class="form-group">
                                                <input class="form-control" type="password" placeholder="Password"
                                                       name="password"
                                                       id="password" autocomplete="off">
                                            </div>
                                            <div class="form-group">
                                                <input class="form-control" type="password" placeholder="Password"
                                                       name="rpassword"
                                                       id="rpassword" autocomplete="off">
                                            </div>
                                            <div class="kt-login__actions">
                                                <button id="kt_login_forgot_new"
                                                        class="btn btn-brand btn-pill btn-elevate">Request
                                                </button>
                                                <button id="kt_login_forgot_cancel"
                                                        class="btn btn-outline-brand btn-pill">
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="kt-grid__item kt-grid__item--fluid kt-grid__item--center kt-grid kt-grid--ver kt-login__content"
                     style="background-image: url({% static "main/media/bg/abstract.jpg" %});">
                    <div class="kt-login__section">
                        <div class="kt-login__block">
                            <h3 class="kt-login__title">Join Our System</h3>
                            <div class="kt-login__desc"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block custom-script %}
    <script type="text/javascript">
        "use strict";

        // Class Definition
        var KTLoginGeneral = function () {

            var showErrorMsg = function (form, type, msg) {
                var alert = $('<div class="kt-alert kt-alert--outline alert alert-' + type + ' alert-dismissible" role="alert">\
			<button type="button" class="close" data-dismiss="alert" aria-label="Close"></button><span></span></div>');

                form.find('.alert').remove();
                alert.prependTo(form);
                //alert.animateClass('fadeIn animated');
                KTUtil.animateClass(alert[0], 'fadeIn animated');
                alert.find('span').html(msg);
            }


            var handleForgotNewFormSubmit = function () {
                $('#kt_login_forgot_new').click(function (e) {
                    e.preventDefault();

                    var btn = $(this);
                    var form = $(this).closest('form');

                    form.validate({
                        rules: {
                            password: {
                                required: true,
                                minlength: 8
                            },
                            rpassword: {
                                required: true,
                                minlength: 8,
                                equalTo: "#password"
                            },
                        }
                    });

                    if (!form.valid()) {
                        return;
                    }

                    btn.addClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', true);

                    form.ajaxSubmit({
                        url: '{{ request.path }}',
                        type: 'post',
                        success: function (response, status, xhr, $form) {
                            setTimeout(function () {
                                btn.removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false); // remove
                                form.clearForm(); // clear form
                                form.validate().resetForm(); // reset validation states

                                showErrorMsg(form, 'success', 'Cool! Your password has been updated!');
                            }, 2000);
                            setTimeout(function () {
                                window.location.replace('/')
                            }, 1000);
                        }
                    });
                });
            }


            // Public Functions
            return {
                // public functions
                init: function () {
                    handleForgotNewFormSubmit();
                }
            };
        }();

        // Class Initialization
        jQuery(document).ready(function () {
            KTLoginGeneral.init();
        });
    </script>
{% endblock %}